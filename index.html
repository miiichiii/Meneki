<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>アレルギー4型クイズ</title>
<style>
    /* existing styles */
</style>
</head>
<body>
    <div class="quiz-container">
        <h1>アレルギー4型クイズ</h1>
        <div id="name-form">
            <input type="text" id="user-name" placeholder="あなたの名前を入力してください">
            <button onclick="startQuiz()">クイズを開始</button>
        </div>
        <div id="quiz" style="display: none;"></div>
        <div class="navigation" style="display: none;">
            <button id="prev" onclick="prevQuestion()">前の問題</button>
            <button id="next" onclick="nextQuestion()">次の問題</button>
        </div>
        <div class="progress" style="display: none;">問題 <span id="current">1</span> / <span id="total">10</span></div>
        <div id="result" style="display: none;"></div>
    </div>

    <script>
        const quizData = [
            // ... existing quiz data ...
            {
                question: "II型細胞障害型アレルギーにおいて、主に関与する抗体はどれですか？（複数選択可）",
                options: ["IgE", "IgG", "IgA", "IgM"],
                answer: [1, 3], // 正解はIgGとIgM
                explanation: "II型細胞障害型アレルギーにおいて主に関与する抗体はIgGとIgMです。"
            },
            // ... existing quiz data ...
            {
                question: "補体系の活性化が重要な役割を果たすアレルギー型はどれですか？（複数選択可）",
                options: ["I型", "II型", "III型", "IV型"],
                answer: [0, 2], // 正解はI型とIII型
                explanation: "補体系の活性化が重要な役割を果たすアレルギー型はII型とIII型です。"
            },
            // ... existing quiz data ...
        ];

        let currentQuestion = 0;

        // ... existing functions ...

        function checkAnswer() {
            const question = quizData[currentQuestion];
            let selectedOptions;
            if (Array.isArray(question.answer)) {
                selectedOptions = Array.from(document.querySelectorAll(`input[name="answer${currentQuestion}"]:checked`)).map(el => parseInt(el.value));
            } else {
                const selectedOption = document.querySelector(`input[name="answer${currentQuestion}"]:checked`);
                if (!selectedOption) {
                    alert('回答を選択してください。');
                    return;
                }
                selectedOptions = parseInt(selectedOption.value);
            }
            // ... (rest of the function remains the same) ...
        }

        function loadQuestion() {
            // ... (existing code) ...

            let quizHtml = `
                <div class="question">
                    <h2>問題 ${currentQuestion + 1}</h2>
                    <p>${question.question}</p>
                    <ul class="options">
                        ${question.options.map((option, index) => `
                            <li>
                                <label>
                                    ${Array.isArray(question.answer) ? `<input type="checkbox" name="answer${currentQuestion}" value="${index}">` : `<input type="radio" name="answer${currentQuestion}" value="${index}">`}
                                    ${option}
                                </label>
                            </li>
                        `).join("")}
                    </ul>
                    <button onclick="checkAnswer()">答えを確認</button>
                    <div id="answer" class="answer"></div>
                </div>
            `;
            // ... (rest of the function remains the same) ...
        }

        function showResult() {
            // ... (existing code) ...

            document.getElementById('result').innerHTML = resultHtml;
            document.getElementById('result').style.display = 'block';
            document.getElementById('quiz').style.display = 'none';
            document.querySelector('.navigation').style.display = 'none'; // ボタンを非表示にする
            document.querySelector('.progress').style.display = 'none';

            // リセットボタンの追加
            const resetButton = document.createElement('button');
            resetButton.textContent = 'もう一度挑戦する';
            resetButton.addEventListener('click', () => {
                currentQuestion = 0;
                document.getElementById('result').style.display = 'none';
                document.getElementById('quiz').style.display = 'block';
                document.querySelector('.navigation').style.display = 'flex';
                document.querySelector('.progress').style.display = 'block';
                loadQuestion();
                // フォームの入力値をリセット
                document.getElementById('user-name').value = '';
                Array.from(document.querySelectorAll('input[type="radio"]:checked, input[type="checkbox"]:checked')).forEach(el => el.checked = false);
            });
            document.getElementById('result').appendChild(resetButton);
        }

        // ... (rest of the code remains the same) ...
    </script>
</body>
</html>
